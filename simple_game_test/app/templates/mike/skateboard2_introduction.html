{% extends "base.html" %}

{% block content %}

<!-- Corrected static CSS path -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" type="text/css" />

<script src="https://cdn.socket.io/4.6.0/socket.io.min.js" 
        integrity="sha384-c79GN5VsunZvi+Q/WObgk2in0CbZsHnjEqvFxC5DxHn9lTfNce2WW6h2pH6u/kF+" 
        crossorigin="anonymous"></script>

<div id="container-instructions" class="text-center">
    <hr />
    <h2>Welcome to a new game!</h2>
    <br>
    <h3> Here are a few configurations that you may see in this section.</h3>

    <!-- Corrected image paths -->
    <img src="{{ url_for('static', filename='img/skateboard2_1.png') }}" width="350" height="auto" />
    <img src="{{ url_for('static', filename='img/skateboard2_2.png') }}" width="350" height="auto" hspace="20" vspace="20" />
    <img src="{{ url_for('static', filename='img/skateboard2_3.png') }}" width="350" height="auto" />
    <br><br>

    <h3>In this game, the <b>task</b> is the following:</h3>

    <table class="center">
        <tr>
            <th>Task</th>
            <th>Sample sequence</th>
        </tr>
        <tr>
            <td>Moving into the grey square</td>
            <td>
                <img src="{{ url_for('static', filename='img/skateboard2_goal1.png') }}" width="150" height="auto" />
                <img src="{{ url_for('static', filename='img/arrow.png') }}" width="30" height="auto" />
                <img src="{{ url_for('static', filename='img/skateboard2_goal2.png') }}" width="150" height="auto" />
            </td>
        </tr>
    </table>

    <br><br>

    <h3>In this game, the following actions affect Chip's energy differently:</h3>

    <h4>
        <b><u>Please take time to understand these actions</u></b> as they will influence your ability to understand Chip's demonstrations. <br>
        <b> Note: </b> A timer runs during the lessons of the game. Make sure you are actively learning to reset the timer, or you may be removed from the study due to inactivity.
    </h4>

    <table class="center">
        <tr>
            <th>Action</th>
            <th>Sample sequence(s)</th>
            <th>Energy change</th>
        </tr>
        <tr>
            <td>Moving with the orange rectangle grabbed</td>
            <td>
                <img src="{{ url_for('static', filename='img/skateboard2_skateboard2.png') }}" width="75" height="auto" />
                <img src="{{ url_for('static', filename='img/arrow.png') }}" width="30" height="auto" />
                <img src="{{ url_for('static', filename='img/skateboard2_skateboard3.png') }}" width="75" height="auto" />
            </td>
            <td><b>???</b><br><b>Hint:</b> Moving with the rectangle grabbed increases Chip's energy.</td>
        </tr>
        <tr>
            <td>Moving <u>out of</u> a purple square</td>
            <td>
                <img src="{{ url_for('static', filename='img/skateboard2_purple1.png') }}" width="150" height="auto" />
                <img src="{{ url_for('static', filename='img/arrow.png') }}" width="30" height="auto" />
                <img src="{{ url_for('static', filename='img/skateboard2_purple2.png') }}" width="150" height="auto" />
            </td>
            <td><b>???</b></td>
        </tr>
        <tr>
            <td>Any action that you take (e.g., moving right, grabbing, etc.)</td>
            <td>
                <img src="{{ url_for('static', filename='img/right1.png') }}" width="150" height="auto" />
                <img src="{{ url_for('static', filename='img/arrow.png') }}" width="30" height="auto" />
                <img src="{{ url_for('static', filename='img/right2.png') }}" width="150" height="auto" />
                <br><br>
                <img src="{{ url_for('static', filename='img/skateboard2_skateboard1.png') }}" width="75" height="auto" />
                <img src="{{ url_for('static', filename='img/arrow.png') }}" width="30" height="auto" />
                <img src="{{ url_for('static', filename='img/skateboard2_skateboard2.png') }}" width="75" height="auto" />
            </td>
            <td><b>???</b></td>
        </tr>
    </table>

    <br>
    <p>
        **Note that you <b>cannot</b> move into a purple square while having picked up the orange rectangle.
    </p>
    <img src="{{ url_for('static', filename='img/skateboard2_invalid1.png') }}" width="150" height="auto" />
    <img src="{{ url_for('static', filename='img/arrow-overlay.png') }}" width="40" height="auto" />
    <img src="{{ url_for('static', filename='img/skateboard2_invalid2.png') }}" width="150" height="auto" />

    <br><br>

    <h3>Chip will now provide a few demonstrations of the best strategy for this game.</h3>

    <hr />

    <div class="instructionsnav">
        <div class="row justify-content-between">
            <div class="col-xs-3">
                <!-- Placeholder for previous button if needed -->
            </div>
            <div class="col-xs-3">
                <button type="button" id="next" 
                        onclick="window.location.href='{{ url_for('sb') }}'" 
                        value="next" 
                        class="btn btn-primary btn-lg continue">
                    Next <span class="glyphicon glyphicon-arrow-right"></span>
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    // var socket = io();

    // // Automatically determine the correct base URL
    let isLocal = window.location.hostname === "127.0.0.1" || window.location.hostname === "localhost";

    let socket = io.connect(
        isLocal ? "http://127.0.0.1:5000" : "/flask_closed_loop_teaching",
        { path: isLocal ? "/socket.io/" : "/flask_closed_loop_teaching/socket.io/",
        transports: ['polling']  // Ensures polling first, then WebSocket
        }
    );
</script>

{% endblock %}
