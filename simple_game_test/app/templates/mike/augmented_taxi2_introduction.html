{% extends "base.html" %}
{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" type="text/css" />
<script src="https://cdn.socket.io/4.6.0/socket.io.min.js" integrity="sha384-c79GN5VsunZvi+Q/WObgk2in0CbZsHnjEqvFxC5DxHn9lTfNce2WW6h2pH6u/kF+" crossorigin="anonymous"></script>

<div id="container-instructions" class="text-center">
    <hr />

    <h2>Welcome to a new game!</h2> <br>
    <h3> Here are a few configurations that you may see in this section.</h3>

    <img src="{{ url_for('static', filename='img/augmented_taxi.png') }}" width="250" height="auto" />
    <img src="{{ url_for('static', filename='img/augmented_taxi2_2.png') }}" width="250" height="auto" hspace="20" vspace="20" />
    <img src="{{ url_for('static', filename='img/augmented_taxi2_3.png') }}" width="250" height="auto" />
    <br>
    <br>

    <h3>In this game, the <b>task</b> is the following:</h3>

    <table class="center">
        <tr>
            <th>Task</th>
            <th>Sample sequence</th>
        </tr>
        <tr>
            <td>Dropping off the circle at the grey square</td>
            <td>
                <img src="{{ url_for('static', filename='img/augmented_taxi_dropoff1.png') }}" width="75" height="auto" />
                <img src="{{ url_for('static', filename='img/arrow.png') }}" width="30" height="auto" />
                <img src="{{ url_for('static', filename='img/augmented_taxi_dropoff2.png') }}" width="75" height="auto" />
            </td>
        </tr>
    </table>

    <br><br>

    <h3>In this game, the following actions affect Chip's energy differently:</h3>

    <h4><b><u>Please take time to understand these actions</u></b> as they will influence your ability to understand Chip's demonstrations. <br>
        <b> Note: </b> A timer runs during the lessons of the game, so make sure you are actively learning the lesson to reset the timer. You will be removed from the study if you are inactive when the timer runs out.
    </h4>

    <table class="center">
        <tr>
            <th>Actions</th>
            <th>Sample sequence(s)</th>
            <th>Energy change</th>
        </tr>
        <tr>
            <td>Moving <u>out of</u> a yellow square (e.g. into yellow <u>or</u> white square)</td>
            <td>
                <img src="{{ url_for('static', filename='img/augmented_taxi2_toll1.png') }}" height="125" />
                <img src="{{ url_for('static', filename='img/arrow.png') }}" width="30" height="auto" />
                <img src="{{ url_for('static', filename='img/augmented_taxi2_toll2.png') }}" height="125" />
            </td>
            <td><b>???</b></td>
        </tr>
        <tr>
            <td>Moving through the green hexagon</td>
            <td>
                <img src="{{ url_for('static', filename='img/augmented_taxi2_battery1.png') }}" width="75" height="auto" />
                <img src="{{ url_for('static', filename='img/arrow.png') }}" width="30" height="auto" />
                <img src="{{ url_for('static', filename='img/augmented_taxi2_battery2.png') }}" width="75" height="auto" />
                <img src="{{ url_for('static', filename='img/arrow.png') }}" width="30" height="auto" />
                <img src="{{ url_for('static', filename='img/augmented_taxi2_battery3.png') }}" width="75" height="auto" />
            </td>
            <td><b>???</b></td>
        </tr>
        <tr>
            <td>Any action that you take (e.g. moving right, grabbing, etc)</td>
            <td>
                <img src="{{ url_for('static', filename='img/right1.png') }}" width="150" height="auto" />
                <img src="{{ url_for('static', filename='img/arrow.png') }}" width="30" height="auto" />
                <img src="{{ url_for('static', filename='img/right2.png') }}" width="150" height="auto" />
            </td>
            <td><b>???</b></td>
        </tr>
    </table>

    <br><br>

    <h3>Chip will now provide a few demonstrations of the best strategy for this game.</h3>

    <hr />

    <div class="instructionsnav">
        <div class="row justify-content-between">
            <div class="col-xs-3"></div>
            <div class="col-xs-3">
                <button type="button" id="next" onclick="window.location.href='{{ url_for('at') }}'" value="next"
                    class="btn btn-primary btn-lg continue">
                    Next <span class="glyphicon glyphicon-arrow-right"></span>
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    // var socket = io();

    // // Automatically determine the correct base URL
    let isLocal = window.location.hostname === "127.0.0.1" || window.location.hostname === "localhost";

    let socket = io.connect(
        isLocal ? "http://127.0.0.1:5000" : "/flask_closed_loop_teaching",
        { path: isLocal ? "/socket.io/" : "/flask_closed_loop_teaching/socket.io/",
        transports: ['polling']  // Ensures polling first, then WebSocket
        }
    );
</script>
{% endblock %}
